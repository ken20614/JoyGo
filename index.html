<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyçš„ç§˜å¯†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .node-container {
            transition: all 0.3s ease;
        }
        .risk-low {
            background-color: #d1fae5;
            border-color: #6ee7b7;
            color: #065f46;
        }
        .risk-medium {
            background-color: #fef3c7;
            border-color: #fcd34d;
            color: #92400e;
        }
        .risk-high {
            background-color: #fee2e2;
            border-color: #fca5a5;
            color: #991b1b;
        }
        .risk-none {
            background-color: #f3f4f6;
            border-color: #d1d5db;
            color: #374151;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">æˆ¿ç”¢è™•ç†æ±ºç­–æ¨¹</h1>
                <button onclick="resetData()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">
                    é‡ç½®è³‡æ–™
                </button>
            </div>

            <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                <div class="text-sm text-gray-700">
                    <div class="font-semibold mb-2">ä½¿ç”¨èªªæ˜ï¼š</div>
                    <ul class="list-disc list-inside space-y-1">
                        <li>é»æ“Š âœï¸ ç·¨è¼¯é¸é …å…§å®¹</li>
                        <li>é»æ“Š â• æ–°å¢å­é¸é …</li>
                        <li>é»æ“Š ğŸ—‘ï¸ åˆªé™¤é¸é …</li>
                        <li>é»æ“Šç®­é ­å±•é–‹/æ”¶åˆå­é¸é …</li>
                        <li>è³‡æ–™æœƒè‡ªå‹•å„²å­˜åœ¨ç€è¦½å™¨ä¸­</li>
                    </ul>
                </div>
            </div>

            <div id="treeContainer"></div>
        </div>
    </div>

    <script>
        const initialData = {
            id: 'root',
            text: 'æˆ¿å­',
            expanded: true,
            children: [
                {
                    id: 'sell',
                    text: 'è³£',
                    risk: 'low',
                    expanded: true,
                    children: [
                        {
                            id: 'sell-1',
                            text: 'å„Ÿé‚„è²¸æ¬¾å¾Œé¤˜é¡å‡åˆ†å…©æ¸…',
                            note: 'é¢¨éšªæœ€ä½ã€æœ€ä¹¾è„†',
                            risk: 'low'
                        }
                    ]
                },
                {
                    id: 'not-sell',
                    text: 'ä¸è³£',
                    expanded: true,
                    children: [
                        {
                            id: 'litigation',
                            text: 'è¨´è¨Ÿè·¯ç·š',
                            note: 'é›™è¼¸æ¨¡å¼',
                            risk: 'high',
                            expanded: true,
                            children: [
                                {
                                    id: 'lit-1',
                                    text: 'å‰©é¤˜è²¡ç”¢åˆ†é…è«‹æ±‚æ¬Š',
                                    note: 'æœƒç‰½å‹•åä¸‹å…¶ä»–è²¡ç”¢',
                                    risk: 'high'
                                },
                                {
                                    id: 'lit-2',
                                    text: 'åˆ†å‰²å…±æœ‰ç‰©',
                                    note: 'é›¢å©šå¤–çš„å¦ä¸€å€‹å®˜å¸',
                                    risk: 'high'
                                },
                                {
                                    id: 'lit-3',
                                    text: 'æ³•æ‹',
                                    note: 'æœ€å¾Œæ‰‹æ®µ æœƒå½±éŸ¿æˆ‘ä¿¡ç”¨',
                                    risk: 'high'
                                }
                            ]
                        },
                        {
                            id: 'non-litigation',
                            text: 'éè¨´è¨Ÿè·¯ç·š',
                            risk: 'medium',
                            expanded: true,
                            children: [
                                {
                                    id: 'agree-1',
                                    text: 'å”è­° + åŒä½',
                                    note: 'å¿ƒç†å£“åŠ›å¤§ï¼Œä½†æ³•å¾‹æœ€å®‰å…¨ ç§ŸèœœåŸºåœ°',
                                    risk: 'medium'
                                },
                                {
                                    id: 'agree-2',
                                    text: 'å”è­° + ä»–æ¬å‡ºå»',
                                    note: 'èƒ½æ¥å—çš„ç‰ˆæœ¬',
                                    risk: 'low'
                                },
                                {
                                    id: 'agree-3',
                                    text: 'å”è­° + æˆ‘æ¬å‡ºå»',
                                    note: 'æœ€ä¸åˆ©è·¯ç·š',
                                    risk: 'high'
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        let treeData = null;
        let editingId = null;

        function loadData() {
            const saved = localStorage.getItem('decisionTree');
            treeData = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(initialData));
        }

        function saveData() {
            localStorage.setItem('decisionTree', JSON.stringify(treeData));
        }

        function resetData() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸã€‚')) {
                treeData = JSON.parse(JSON.stringify(initialData));
                saveData();
                render();
            }
        }

        function getRiskClass(risk) {
            return risk ? `risk-${risk}` : 'risk-none';
        }

        function getRiskBadge(risk) {
            switch(risk) {
                case 'low': return 'âœ“ ä½é¢¨éšª';
                case 'medium': return '! ä¸­é¢¨éšª';
                case 'high': return 'âœ— é«˜é¢¨éšª';
                default: return '';
            }
        }

        function findNode(nodes, id) {
            for (let node of nodes) {
                if (node.id === id) return node;
                if (node.children) {
                    const found = findNode(node.children, id);
                    if (found) return found;
                }
            }
            return null;
        }

        function updateNode(id, updates) {
            const node = findNode([treeData], id);
            if (node) {
                Object.assign(node, updates);
                saveData();
                render();
            }
        }

        function deleteNode(nodes, id) {
            return nodes.filter(node => {
                if (node.id === id) return false;
                if (node.children) {
                    node.children = deleteNode(node.children, id);
                }
                return true;
            });
        }

        function addChild(id) {
            const parent = findNode([treeData], id);
            if (parent) {
                if (!parent.children) parent.children = [];
                parent.children.push({
                    id: `node-${Date.now()}`,
                    text: 'æ–°é¸é …',
                    note: '',
                    risk: '',
                    children: []
                });
                parent.expanded = true;
                saveData();
                render();
            }
        }

        function toggleExpand(id) {
            const node = findNode([treeData], id);
            if (node) {
                node.expanded = !node.expanded;
                saveData();
                render();
            }
        }

        function startEdit(id) {
            editingId = id;
            render();
        }

        function saveEdit(id) {
            const text = document.getElementById('edit-text').value;
            const note = document.getElementById('edit-note').value;
            const risk = document.getElementById('edit-risk').value;
            
            updateNode(id, { text, note, risk });
            editingId = null;
        }

        function cancelEdit() {
            editingId = null;
            render();
        }

        function deleteNodeById(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é¸é …å—ï¼Ÿ')) {
                treeData.children = deleteNode([treeData], id);
                saveData();
                render();
            }
        }

        function renderNode(node, level = 0) {
            const hasChildren = node.children && node.children.length > 0;
            const isExpanded = node.expanded !== false;
            const isEditing = editingId === node.id;

            let html = '<div class="my-2 node-container">';
            html += `<div class="flex items-start gap-2 p-3 rounded-lg border-2 ${getRiskClass(node.risk)}">`;

            if (hasChildren) {
                html += `<button onclick="toggleExpand('${node.id}')" class="mt-1 hover:bg-white/50 rounded p-1">
                    ${isExpanded ? 'â–¼' : 'â–¶'}
                </button>`;
            }

            html += '<div class="flex-1">';

            if (isEditing) {
                const currentNode = findNode([treeData], node.id);
                html += `
                    <div class="space-y-2">
                        <input type="text" id="edit-text" value="${currentNode.text}" 
                            class="w-full px-2 py-1 border rounded" placeholder="é¸é …åç¨±">
                        <input type="text" id="edit-note" value="${currentNode.note || ''}" 
                            class="w-full px-2 py-1 border rounded text-sm" placeholder="å‚™è¨»èªªæ˜">
                        <select id="edit-risk" class="px-2 py-1 border rounded text-sm">
                            <option value="" ${!currentNode.risk ? 'selected' : ''}>ç„¡é¢¨éšªæ¨™è¨˜</option>
                            <option value="low" ${currentNode.risk === 'low' ? 'selected' : ''}>ä½é¢¨éšª</option>
                            <option value="medium" ${currentNode.risk === 'medium' ? 'selected' : ''}>ä¸­é¢¨éšª</option>
                            <option value="high" ${currentNode.risk === 'high' ? 'selected' : ''}>é«˜é¢¨éšª</option>
                        </select>
                        <div class="flex gap-2">
                            <button onclick="saveEdit('${node.id}')" 
                                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                                ğŸ’¾ å„²å­˜
                            </button>
                            <button onclick="cancelEdit()" 
                                class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">
                                âœ• å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                `;
            } else {
                html += `<div class="font-semibold text-lg">${node.text}</div>`;
                if (node.note) {
                    html += `<div class="text-sm mt-1 opacity-80">${node.note}</div>`;
                }
                if (node.risk) {
                    html += `<div class="text-xs mt-1 font-medium">${getRiskBadge(node.risk)}</div>`;
                }
            }

            html += '</div>';

            if (!isEditing && node.id !== 'root') {
                html += `
                    <div class="flex gap-1">
                        <button onclick="startEdit('${node.id}')" 
                            class="p-1 hover:bg-white/50 rounded" title="ç·¨è¼¯">âœï¸</button>
                        <button onclick="addChild('${node.id}')" 
                            class="p-1 hover:bg-white/50 rounded" title="æ–°å¢å­é¸é …">â•</button>
                        <button onclick="deleteNodeById('${node.id}')" 
                            class="p-1 hover:bg-white/50 rounded text-red-600" title="åˆªé™¤">ğŸ—‘ï¸</button>
                    </div>
                `;
            }

            html += '</div>';

            if (hasChildren && isExpanded) {
                html += '<div class="ml-8 mt-2 border-l-2 border-gray-300 pl-4">';
                node.children.forEach(child => {
                    html += renderNode(child, level + 1);
                });
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function render() {
            document.getElementById('treeContainer').innerHTML = renderNode(treeData);
        }

        loadData();
        render();
    </script>
</body>

</html>
